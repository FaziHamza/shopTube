<nz-drawer [nzSize]="'large'" [nzWidth]="'80%'" [nzVisible]="IsShowConfig" nzPlacement="right"
  [nzTitle]="'Control List'" (nzOnClose)="closeConfigurationList()">
  <ng-container *nzDrawerContent>
    <div id="mySidenav-right" class="sidenav-right">
      <div class="mySidenav-right">
        <div class="side-nav-body">
          <nz-tabset>
            <nz-tab nzTitle="Action Rules">
              <div class="flex flex-wrap">
                <div class="w-1/3">
                  <ul *ngIf="validationMessage.length">
                    <li *ngFor="let errorObj of validationMessage">{{ errorObj.message }}
                      <button (click)="fixError(errorObj)">Auto Fix</button>
                    </li>
                  </ul>
                  <div style="height: 100%;" #editorRuleContainer></div>
                </div>
                <div class="w-1/3">
                  <textarea [(ngModel)]="actionModel" nz-input placeholder="Form Model"
                    [nzAutosize]="{ minRows: 12, maxRows: 12 }"></textarea>
                  <ul *ngIf="validationMessage.length">
                    <li *ngFor="let errorObj of validationMessage">{{ errorObj.message }}
                      <button (click)="fixError(errorObj)">Auto Fix</button>
                    </li>
                  </ul>
                  <div style="height: 30vh;" #editorActionsContainer></div>

                  <!-- <textarea [(ngModel)]="actionList" nz-input placeholder="User Type"
                    [nzAutosize]="{ minRows: 12, maxRows: 12 }"></textarea> -->
                  <button nz-button nzType="primary" (click)="processActionRules()">Execute Action</button>
                </div>
                <div class="w-1/3">
                  <textarea nz-input [(ngModel)]="actionResult" placeholder="Result"
                    [nzAutosize]="{ minRows: 28, maxRows: 28}"></textarea>
                </div>
              </div>
            </nz-tab>
            <nz-tab nzTitle="Action Form">
              <form [formGroup]="ruleForm">
                <div formArrayName="actionRules">
                  <div *ngFor="let rule of actionRulesControl().controls; let i = index" [formGroupName]="i">
                    <div class="grid grid-cols-3 gap-4">
                      <div class="col-span-2">
                        <div formGroupName="if">
                          <div class="grid grid-cols-4 gap-4">
                            <div class="">
                              <label class="mx-2 mt-2 mb-1">Action Rule</label>
                              <div>
                                <input nz-input type="text" placeholder="Enter action rule" formControlName="actionRule"
                                  required class="form-control" />
                              </div>
                            </div>
                            <div class="">
                              <label class="mx-2 mt-2 mb-1">Key</label>
                              <div>
                                <input nz-input type="text" placeholder="Enter Key" formControlName="key" required
                                  class="form-control" />
                              </div>
                            </div>
                            <div class="">
                              <label class="mx-2 mt-2 mb-1">Compare</label>
                              <div>
                                <input nz-input type="text" placeholder="Enter compare" formControlName="compare"
                                  required class="form-control" />
                              </div>
                            </div>
                            <div class="">
                              <label class="mx-2 mt-2 mb-1">Value</label>
                              <div>
                                <input nz-input type="text" placeholder="Enter value" formControlName="value" required
                                  class="form-control" />
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-span-1">
                        <button nz-button nzType="primary" nzDanger class="btn btn-danger mx-1 mt-3"
                          (click)="removeIfThen(i)" type="button">
                          <span nz-icon nzType="delete" nzTheme="outline"></span>
                        </button>
                        <div formGroupName="then">
                          <div *ngFor="let thenAction of addIfThenActions(i).controls; let j = index"
                            [formGroupName]="j">
                            <div class="grid grid-cols-5 gap-4">
                              <div class="col-span-2">
                                <label class="mx-2 mt-2 mb-1">Action Rule</label>
                                <div>
                                  <input nz-input type="text" placeholder="Enter action rule"
                                    formControlName="actionRule" required class="form-control" />
                                </div>
                              </div>
                              <div class="col-span-2">
                                <label class="mx-2 mt-2 mb-1">Key</label>
                                <div>
                                  <input nz-input type="text" placeholder="Enter Key" formControlName="key" required
                                    class="form-control" />
                                </div>
                              </div>
                              <div class="col-span-1 mt-2">
                                <button nz-button nzType="primary" nzDanger class="btn btn-danger mx-1 mt-3"
                                  (click)="removeThenAction(i,j)" type="button">
                                  <span nz-icon nzType="delete" nzTheme="outline"></span>
                                </button>
                              </div>
                            </div>
                          </div>
                          <div class="col-span-1 mt-2">
                            <button nz-button nzType="primary" nzPrimary class="btn btn-primary mt-2"
                              (click)="addIfThenAction(i)">
                              <b>+</b> Add Then Action
                            </button>
                          </div>
                        </div>
                      </div>
                      <div class="col-span-2">
                        <div formGroupName="AND">
                          <button nz-button nzType="primary" nzPrimary class="btn btn-primary mt-2"
                            (click)="addIfAndAction(i)">
                            <b>+</b> AND OR Condition
                          </button>
                          <div *ngFor="let andCondition of addIfAndActions(i).controls; let j = index"
                            [formGroupName]="j">
                            <div class="grid grid-cols-1 gap-4">
                              <div class="col-span-2">
                                <div formGroupName="if">
                                  <div class="grid grid-cols-4 gap-4">
                                    <div class="">
                                      <label class="mx-2 mt-2 mb-1">Action Rule</label>
                                      <div>
                                        <input nz-input type="text" placeholder="Enter action rule"
                                          formControlName="actionRule" required class="form-control" />
                                      </div>
                                    </div>
                                    <div class="">
                                      <label class="mx-2 mt-2 mb-1">Key</label>
                                      <div>
                                        <input nz-input type="text" placeholder="Enter Key" formControlName="key"
                                          required class="form-control" />
                                      </div>
                                    </div>
                                    <div class="">
                                      <label class="mx-2 mt-2 mb-1">Compare</label>
                                      <div>
                                        <input nz-input type="text" placeholder="Enter compare"
                                          formControlName="compare" required class="form-control" />
                                      </div>
                                    </div>
                                    <div class="">
                                      <label class="mx-2 mt-2 mb-1">Value</label>
                                      <div>
                                        <input nz-input type="text" placeholder="Enter value" formControlName="value"
                                          required class="form-control" />
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>
                              <div class="col-span-1">
                                <button nz-button nzType="primary" nzDanger class="btn btn-danger mx-1 mt-3"
                                  (click)="removeIfAndAction(i,j)" type="button">
                                  <span nz-icon nzType="delete" nzTheme="outline"></span>
                                </button>
                                <div formGroupName="then">
                                  <div *ngFor="let thenAction of addThenActions(i, j).controls; let k = index"
                                    [formGroupName]="k">
                                    <div class="grid grid-cols-5 gap-4">
                                      <div class="col-span-2">
                                        <label class="mx-2 mt-2 mb-1">Action Rule</label>
                                        <div>
                                          <input nz-input type="text" placeholder="Enter action rule"
                                            formControlName="actionRule" required class="form-control" />
                                        </div>
                                      </div>
                                      <div class="col-span-2">
                                        <label class="mx-2 mt-2 mb-1">Key</label>
                                        <div>
                                          <input nz-input type="text" placeholder="Enter Key" formControlName="key"
                                            required class="form-control" />
                                        </div>
                                      </div>
                                      <div class="col-span-1 mt-2">
                                        <button nz-button nzType="primary" nzDanger class="btn btn-danger mx-1 mt-3"
                                          (click)="removeAndThenAction(i, j, k)" type="button">
                                          <span nz-icon nzType="delete" nzTheme="outline"></span>
                                        </button>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                            <div class="col-span-1 mt-2">
                              <button nz-button nzType="primary" nzPrimary class="btn btn-primary mt-2"
                                (click)="addThenAction(i, j)">
                                <b>+</b> Add Then Action
                              </button>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <br />
                  </div>
                </div>
                <button nz-button nzType="primary" nzPrimary class="btn btn-primary mb-3 mt-2" (click)="addRule()">
                  <b>+</b>Add Rule</button>
              </form>
            </nz-tab>
          </nz-tabset>
        </div>
      </div>
    </div>
  </ng-container>
</nz-drawer>

<nz-tabset>
  <nz-tab nzTitle="Action Rules">
    <div class="flex flex-wrap">
      <div class="w-1/3">
        <ul *ngIf="validationMessage.length">
          <li *ngFor="let errorObj of validationMessage">{{ errorObj.message }}
            <button (click)="fixError(errorObj)">Auto Fix</button>
          </li>
        </ul>
        <div style="height: 100%;" #editorRuleContainer></div>
      </div>
      <div class="w-1/3">
        <textarea [(ngModel)]="actionModel" nz-input placeholder="Form Model"
          [nzAutosize]="{ minRows: 12, maxRows: 12 }"></textarea>
        <ul *ngIf="validationMessage.length">
          <li *ngFor="let errorObj of validationMessage">{{ errorObj.message }}
            <button (click)="fixError(errorObj)">Auto Fix</button>
          </li>
        </ul>
        <div style="height: 30vh;" #editorActionsContainer></div>

        <!-- <textarea [(ngModel)]="actionList" nz-input placeholder="User Type"
          [nzAutosize]="{ minRows: 12, maxRows: 12 }"></textarea> -->
        <button nz-button nzType="primary" (click)="processActionRules()">Execute Action</button>
      </div>
      <div class="w-1/3">
        <textarea nz-input [(ngModel)]="actionResult" placeholder="Result"
          [nzAutosize]="{ minRows: 28, maxRows: 28}"></textarea>
      </div>
    </div>
  </nz-tab>
  <nz-tab nzTitle="Action Form">
    <form [formGroup]="ruleForm">
      <div formArrayName="actionRules">
        <div *ngFor="let rule of actionRulesControl().controls; let i = index" [formGroupName]="i">
          <div class="grid grid-cols-3 gap-4">
            <div class="col-span-2">
              <div formGroupName="if">
                <div class="grid grid-cols-4 gap-4">
                  <div class="">
                    <label class="mx-2 mt-2 mb-1">Action Rule</label>
                    <div>
                      <input nz-input type="text" placeholder="Enter action rule" formControlName="actionRule"
                        required class="form-control" />
                    </div>
                  </div>
                  <div class="">
                    <label class="mx-2 mt-2 mb-1">Key</label>
                    <div>
                      <input nz-input type="text" placeholder="Enter Key" formControlName="key" required
                        class="form-control" />
                    </div>
                  </div>
                  <div class="">
                    <label class="mx-2 mt-2 mb-1">Compare</label>
                    <div>
                      <input nz-input type="text" placeholder="Enter compare" formControlName="compare"
                        required class="form-control" />
                    </div>
                  </div>
                  <div class="">
                    <label class="mx-2 mt-2 mb-1">Value</label>
                    <div>
                      <input nz-input type="text" placeholder="Enter value" formControlName="value" required
                        class="form-control" />
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-span-1">
              <button nz-button nzType="primary" nzDanger class="btn btn-danger mx-1 mt-3"
                (click)="removeIfThen(i)" type="button">
                <span nz-icon nzType="delete" nzTheme="outline"></span>
              </button>
              <div formGroupName="then">
                <div *ngFor="let thenAction of addIfThenActions(i).controls; let j = index"
                  [formGroupName]="j">
                  <div class="grid grid-cols-5 gap-4">
                    <div class="col-span-2">
                      <label class="mx-2 mt-2 mb-1">Action Rule</label>
                      <div>
                        <input nz-input type="text" placeholder="Enter action rule"
                          formControlName="actionRule" required class="form-control" />
                      </div>
                    </div>
                    <div class="col-span-2">
                      <label class="mx-2 mt-2 mb-1">Key</label>
                      <div>
                        <input nz-input type="text" placeholder="Enter Key" formControlName="key" required
                          class="form-control" />
                      </div>
                    </div>
                    <div class="col-span-1 mt-2">
                      <button nz-button nzType="primary" nzDanger class="btn btn-danger mx-1 mt-3"
                        (click)="removeThenAction(i,j)" type="button">
                        <span nz-icon nzType="delete" nzTheme="outline"></span>
                      </button>
                    </div>
                  </div>
                </div>
                <div class="col-span-1 mt-2">
                  <button nz-button nzType="primary" nzPrimary class="btn btn-primary mt-2"
                    (click)="addIfThenAction(i)">
                    <b>+</b> Add Then Action
                  </button>
                </div>
              </div>
            </div>
            <div class="col-span-2">
              <div formGroupName="AND">
                <button nz-button nzType="primary" nzPrimary class="btn btn-primary mt-2"
                  (click)="addIfAndAction(i)">
                  <b>+</b> AND OR Condition
                </button>
                <div *ngFor="let andCondition of addIfAndActions(i).controls; let j = index"
                  [formGroupName]="j">
                  <div class="grid grid-cols-1 gap-4">
                    <div class="col-span-2">
                      <div formGroupName="if">
                        <div class="grid grid-cols-4 gap-4">
                          <div class="">
                            <label class="mx-2 mt-2 mb-1">Action Rule</label>
                            <div>
                              <input nz-input type="text" placeholder="Enter action rule"
                                formControlName="actionRule" required class="form-control" />
                            </div>
                          </div>
                          <div class="">
                            <label class="mx-2 mt-2 mb-1">Key</label>
                            <div>
                              <input nz-input type="text" placeholder="Enter Key" formControlName="key"
                                required class="form-control" />
                            </div>
                          </div>
                          <div class="">
                            <label class="mx-2 mt-2 mb-1">Compare</label>
                            <div>
                              <input nz-input type="text" placeholder="Enter compare"
                                formControlName="compare" required class="form-control" />
                            </div>
                          </div>
                          <div class="">
                            <label class="mx-2 mt-2 mb-1">Value</label>
                            <div>
                              <input nz-input type="text" placeholder="Enter value" formControlName="value"
                                required class="form-control" />
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="col-span-1">
                      <button nz-button nzType="primary" nzDanger class="btn btn-danger mx-1 mt-3"
                        (click)="removeIfAndAction(i,j)" type="button">
                        <span nz-icon nzType="delete" nzTheme="outline"></span>
                      </button>
                      <div formGroupName="then">
                        <div *ngFor="let thenAction of addThenActions(i, j).controls; let k = index"
                          [formGroupName]="k">
                          <div class="grid grid-cols-5 gap-4">
                            <div class="col-span-2">
                              <label class="mx-2 mt-2 mb-1">Action Rule</label>
                              <div>
                                <input nz-input type="text" placeholder="Enter action rule"
                                  formControlName="actionRule" required class="form-control" />
                              </div>
                            </div>
                            <div class="col-span-2">
                              <label class="mx-2 mt-2 mb-1">Key</label>
                              <div>
                                <input nz-input type="text" placeholder="Enter Key" formControlName="key"
                                  required class="form-control" />
                              </div>
                            </div>
                            <div class="col-span-1 mt-2">
                              <button nz-button nzType="primary" nzDanger class="btn btn-danger mx-1 mt-3"
                                (click)="removeAndThenAction(i, j, k)" type="button">
                                <span nz-icon nzType="delete" nzTheme="outline"></span>
                              </button>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-span-1 mt-2">
                    <button nz-button nzType="primary" nzPrimary class="btn btn-primary mt-2"
                      (click)="addThenAction(i, j)">
                      <b>+</b> Add Then Action
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <br />
        </div>
      </div>
      <button nz-button nzType="primary" nzPrimary class="btn btn-primary mb-3 mt-2" (click)="addRule()">
        <b>+</b>Add Rule</button>
    </form>
  </nz-tab>
</nz-tabset>
<button nz-button nzType="primary" class="btn mr-2" (click)="controlListOpen()"> <i
  class="fa-regular fa-arrow-left mr-2"></i> open</button>


{{this.ruleForm.value | json}}