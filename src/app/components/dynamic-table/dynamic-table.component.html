<!-- {{data | json}} -->
<!-- {{key | json}} -->
<!-- <nz-modal [(nzVisible)]="isVisible" nzWidth=700px nzTitle="The first Modal" (nzOnCancel)="handleCancel()">
  <ng-container *nzModalContent>
    <label class="form-label ml-3 text-base font-bold w-3/12">Column Name</label>
    <input nz-input type="text" class="form-control ml-1  w-4/12" placeholder="Enetr Column Name"
      [(ngModel)]="columnName">
  </ng-container>
</nz-modal> -->
<div *ngIf="data?.isAddRow == undefined ? true: data?.isAddRow">
  <button nz-button (click)="addRow()" *ngIf="!checkType" nzType="primary">Add</button>
  <button nz-button (click)="addColumn()" *ngIf="checkType" nzType="primary">Add</button>
</div>
<br />
<br />
<!-- {{tableData | json}} -->
<nz-table #editRowTable [nzPageSize]="10" [nzBordered]='data.nzBordered'
  [nzData]="tableData" *ngIf="data"
  [nzScroll]="{ x: '100vw', y: null }" [nzLoading]="data?.nzLoading"
  [nzPaginationPosition]='data?.nzPaginationPosition'
  [nzPaginationType]='data?.nzPaginationType'
  [nzFrontPagination]='data?.nzFrontPagination'
  [nzShowPagination]='data?.nzShowPagination'
  [nzTitle]='data?.nzTitle' [nzSize]="data.nzSize" [nzSimple]="data.nzSimple"
  [nzShowSizeChanger]="data.nzShowSizeChanger">
  <thead>
    <tr
      *ngIf="data?.showColumnHeader == undefined ? true : data?.showColumnHeader">
      <th *ngIf="data.showCheckbox" nzWidth="60px" [(nzChecked)]="allChecked"
        [nzIndeterminate]="indeterminate"
        (nzCheckedChange)="checkAll($event)"></th>
      <ng-container *ngFor="let header of tableHeaders">
        <th
          *ngIf="header.name != 'defaultValue' && header.name != 'children' && header.name != 'expandable'"
          [nzSortOrder]="header?.sortOrder" [nzSortFn]="header?.sortFn"
          [nzSortDirections]="header?.sortDirections"
          [nzFilterMultiple]="header?.filterMultiple"
          [nzFilters]="header?.listOfFilter"
          [nzFilterFn]="header?.filterFn"
          (click)="header?.columnClickApi ? onClickColumn(header.columnClickApi,header): ''">
          {{header.name | translate}}<span *ngIf="header?.gridHeaderSum">({{header?.gridHeaderSum}})</span>
        </th>
      </ng-container>
      <th>Delete</th>
    </tr>
  </thead>
  <tbody>
    <ng-template #recursiveList let-data1>
      <ng-container *ngFor="let item of data1 ; let i = index">
        <tr [ngStyle]="{'background': item?.color}" *ngIf="!responsiveTable"
          (click)="data?.rowClickApi!='' ? onClickRow(data.rowClickApi,item): ''">
          <td *ngIf="item.expandable" [(nzExpand)]="item.expand"></td>
          <td *ngIf="data.showCheckbox" [(nzChecked)]="item.checked"
            (nzCheckedChange)="refreshStatus()"></td>
          <ng-container
            *ngFor="let header of data['tableKey']; let index = index">
            <td [nzEllipsis]="true" class="5"
              *ngIf="header.name != 'description' && header.name != 'headerButton' && header.name != 'footerButton' && header.name != 'expandable' && header.name != 'checked'
            && header.name != 'expand' && header.name !='children' && header.name != 'defaultValue' && header.name != 'children' && item[header.name]">
              <div class="1"
                *ngIf="tableHeaders[index]?.dataType !='select' && tableHeaders[index]?.dataType !='image' && !isMyDataArray(item[header.name]) && item[header.name]">
                <div class="editable-cell" [hidden]="editId === item.id"
                  (click)="startEdit(item.id)">
                  <!-- {{header.name | json}} -->
                  {{item[header.name] | translate}}
                </div>
                <input [hidden]="editId !== item.id" type="text" nz-input
                  [(ngModel)]="item[header.name]" />
              </div>
              <div class="2"
                *ngIf="tableHeaders[index]?.dataType =='select' && tableHeaders[index]?.dataType !='image' || isMyDataArray(item[header.name])">
                <nz-select nzAllowClear nzShowSearch style="width: 100px"
                  nzPlaceHolder="Select Value"
                  [(ngModel)]="item.defaultValue"
                  (ngModelChange)="select(i, $event)">
                  <nz-option *ngFor="let option of item[header.name]"
                    [nzLabel]="option.type ? option.type : option.key"
                    [nzValue]="option.value ? option.value : option">
                  </nz-option>
                </nz-select>
              </div>

              <div *ngIf="tableHeaders[index]?.dataType =='image'" class="4">
                <img nz-image width="80px" height="80px"
                  nzSrc="https://zos.alipayobjects.com/rmsportal/jkjgkEfvpUPVyRjUImniVslZfWPnJuuZ.png"
                  alt />
              </div>
            </td>
            <td *ngIf="header.name == 'headerButton'">
              <button (click)="showModal('Header')" type="button"
                class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                Button
              </button>
            </td>
            <td *ngIf="header.name == 'footerButton'">
              <button type="button" (click)="showModal('Footer')"
                class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                Button
              </button>
            </td>
          </ng-container>

          <td>
            <a nz-popconfirm nzPopconfirmTitle="Sure to delete?"
              (nzOnConfirm)="deleteRow(item)">
              <span class="text-red-500" nz-icon nzType="delete"
                nzTheme="outline"></span>
            </a>
          </td>
        </tr>
        <ng-container *ngIf="responsiveTable">
          <tr  *ngFor="let entry of item | keyvalue">
            <td class="font-bold">{{entry.key}}</td>
            <td>{{entry.value}}</td>
          </tr>
          <tr colspan="1">
            <td class="font-bold">Action</td>
            <td >
              <a nz-popconfirm nzPopconfirmTitle="Sure to delete?" (nzOnConfirm)="deleteRow(item)">
                <span class="text-red-500" nz-icon nzType="delete" nzTheme="outline"></span>
              </a>
            </td>
          </tr>
        </ng-container>
        

        <!-- <tr [nzExpand]="item.expand">
        <td colspan="4">
          <dynamic-table *ngIf="item?.children?.length" [tableId]='tableId' [checkType]='true'
            [tableData]='item.children' [tableHeaders]='tableHeaders' [data]="data"></dynamic-table>
        </td>
      </tr> -->

        <!-- <ng-container *ngIf="item.children?.length > 0 && data.expandable" >
    <tr *ngFor="let child of item.children" [nzExpand]="item.expand">
      <td colspan="8">
        <nz-table #recursiveTableChild [nzData]="child" [nzPageSize]="10">
          <thead>
            <th *ngFor="let ch of childKey" >{{ch}}</th>
          </thead>
          <tbody>
            <ng-container *ngFor="let key of childKey">
              <td [nzEllipsis]="true" *ngIf="key != 'description' && key != 'checked' && key != 'expand'">
                <div class="editable-cell" [hidden]="editId === child.id+item.id" (click)="startEdit(child.id+item.id)">
                  {{child[key]}}
                </div>
                <input [hidden]="editId !== child.id+item.id" type="text" nz-input [(ngModel)]="child[key]" />
              </td>
            </ng-container>
          </tbody>
        </nz-table>
      </td>
    </tr>
  </ng-container> -->
      </ng-container>

      <!-- <tr *ngIf="data.expandable" [nzExpand]="item.expand">
  <th *ngFor="let child of childKey" nzWidth="80px">{{child}}</th>
</tr>
<ng-container *ngFor="let child of item.children">
  <tr *ngIf="data.expandable" [nzExpand]="item.expand">
    <ng-container *ngFor="let key of childKey">
      <td [nzEllipsis]="true" *ngIf="key != 'description' && key != 'checked' && key != 'expand'">
        <div class="editable-cell" [hidden]="editId === child.id" (click)="startEdit(child.id)">
          {{child[key]}}
        </div>
        <input [hidden]="editId !== child.id" type="text" nz-input [(ngModel)]="child[key]" />
      </td>
    </ng-container>
  </tr>
</ng-container> -->
    </ng-template>
    <!-- <ng-container *ngTemplateOutlet="recursiveKeyList; context:{ $implicit: editRowTable.data }"></ng-container> -->
    <ng-container
      *ngTemplateOutlet="recursiveList; context:{ $implicit: editRowTable.data }"></ng-container>
  </tbody>
  <tfoot *ngIf="data?.nzFooter" class="bg-gray-100">
    <tr nz-custom-footer>
      <td nzWidth="40px" *ngIf="data.expandable"></td>
      <td *ngIf="data.showCheckbox" nzWidth="60px"></td>
      <td *ngFor="let header of footerData"> <span *ngIf="header.gridFooterSum">
          ({{header.gridFooterSum}})</span>
      </td>
      <td></td>
    </tr>
  </tfoot>
</nz-table>

<div *ngIf="data?.isAddRow == undefined ? true: data?.isAddRow">
  <button nz-button (click)="save()" nzType="primary">Save options</button>
</div>
<!-- {{data | json}} -->
<nz-modal [nzWidth]="1400" [(nzVisible)]="isHeaderVisible" nzTitle="Grid Rule"
  (nzOnCancel)="handleCancel()"
  (nzOnOk)="handleOk()">
  <ng-container *nzModalContent>
    <st-business-rule-grid [GridType]="GridType"
      [selectedNode]="_dataSharedService.selectedNode"
      [screenName]="_dataSharedService.screenName"
      [screenModule]="_dataSharedService.screenModule"
      [nodes]="_dataSharedService.nodes"></st-business-rule-grid>
  </ng-container>
</nz-modal>

<!-- <style>
  html,
  body {
    height: 100%;
  }

  @media (min-width: 640px) {
    nz-table {
      display: inline-table !important;
    }

    .ant-table-thead th.ant-table-column-has-sorters {
      display: none;
    }

    thead tr:not(:first-child) {
      display: none;
    }
  }

  td:not(:last-child) {
    border-bottom: 0;
  }

  th:not(:last-child) {
    border-bottom: 2px solid rgba(0, 0, 0, .1);
  }
</style> -->
